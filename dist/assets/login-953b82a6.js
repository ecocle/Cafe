import{j as e,r as d,c as $,L as E}from"./index-bc29a6f4.js";const z="_popup_rz8tk_1",F="_close_rz8tk_14",O="_button_rz8tk_22",U="_popupInner_rz8tk_32",l={popup:z,close:F,button:O,popupInner:U,"slide-in":"_slide-in_rz8tk_1","fade-in":"_fade-in_rz8tk_1"};function m(n){this.message=n}m.prototype=new Error,m.prototype.name="InvalidCharacterError";var k=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(n){var s=String(n).replace(/=+$/,"");if(s.length%4==1)throw new m("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,o,i=0,r=0,a="";o=s.charAt(r++);~o&&(t=i%4?64*t+o:o,i++%4)?a+=String.fromCharCode(255&t>>(-2*i&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return a};function A(n){var s=n.replace(/-/g,"+").replace(/_/g,"/");switch(s.length%4){case 0:break;case 2:s+="==";break;case 3:s+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(k(t).replace(/(.)/g,function(o,i){var r=i.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}(s)}catch{return k(s)}}function u(n){this.message=n}function D(n,s){if(typeof n!="string")throw new u("Invalid token specified");var t=(s=s||{}).header===!0?0:1;try{return JSON.parse(A(n.split(".")[t]))}catch(o){throw new u("Invalid token specified: "+o.message)}}u.prototype=new Error,u.prototype.name="InvalidTokenError";const L="_popup_18016_2",P="_open_18016_16",q="_popupInner_18016_20",_={popup:L,open:P,popupInner:q},B=({onClose:n,selectedLanguage:s})=>e.jsx("div",{className:_.popup,children:e.jsxs("div",{className:_.popupInner,children:[e.jsx("h2",{children:s==="chinese"?"登陆成功！":"Login successful!"}),e.jsx("p",{children:s==="chinese"?"成功的登陆了。":"Logged in successfully."}),e.jsx("button",{onClick:n,className:_.closeBtn,children:s==="chinese"?"返回":"Go back"})]})}),G="_popup_18016_2",J="_open_18016_16",R="_popupInner_18016_20",j={popup:G,open:J,popupInner:R},H=({onClose:n,selectedLanguage:s})=>e.jsx("div",{className:j.popup,children:e.jsxs("div",{className:j.popupInner,children:[e.jsx("h2",{children:s==="chinese"?"账号不存在！":"Accounts does not exist!"}),e.jsx("p",{children:s==="chinese"?"尝试检查您的用户名和密码。":"Try checking your username and password."}),e.jsx("button",{onClick:n,className:j.closeBtn,children:s==="chinese"?"返回":"Go back"})]})}),V=({className:n,onLoginSuccess:s,onClose:t,selectedLanguage:o})=>{const[i,r]=d.useState(!1),[a,v]=d.useState(""),[g,y]=d.useState(""),[h,b]=d.useState({login:!1,success:!1,failed:!1}),I=c=>{t(c)},C=async()=>{const c={username:a,password:g};r(!0);try{const p=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});p.ok?(r(!1),S()):p.status===404?(r(!1),f()):(f(),r(!1),console.error(`Error: ${p.statusText}`));const x=(await p.json()).token;localStorage.setItem("token",x);const w=D(x).username;localStorage.setItem("username",w),s(w,x)}catch{r(!1),f()}},S=()=>{b(()=>({login:!0,success:!0,failed:!1}))},f=()=>{b(()=>({login:!0,failed:!0,success:!1}))},N=c=>{t(c)},T=c=>{t(c)};return e.jsxs("div",{className:$(l.root,n),children:[i&&e.jsx(E,{}),e.jsxs("div",{className:l.popup,children:[h.login&&e.jsxs(e.Fragment,{children:[h.success&&e.jsx("div",{children:e.jsx(B,{onClose:N,selectedLanguage:o})}),h.failed&&e.jsx("div",{children:e.jsx(H,{onClose:T,selectedLanguage:o})})]}),e.jsxs("div",{className:l.popupInner,children:[e.jsx("button",{onClick:I,className:l.close,children:o==="chinese"?"关闭":"Close"}),e.jsx("label",{children:o==="chinese"?"用户名:":"Username:"}),e.jsx("br",{}),e.jsx("input",{type:"text",value:a,onChange:c=>v(c.target.value),required:!0}),e.jsx("br",{}),e.jsx("label",{children:o==="chinese"?"密码:":"Password:"}),e.jsx("br",{}),e.jsx("input",{type:"password",value:g,onChange:c=>y(c.target.value),required:!0}),e.jsx("br",{}),e.jsx("button",{className:l.button,type:"button",onClick:C,children:o==="chinese"?"登陆":"Login"})]})]})]})};export{V as Login};
