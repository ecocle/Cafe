import{j as e,r as d,c as T,L as E}from"./index-2d54aa2d.js";const F="_popup_1f9xl_1",O="_close_1f9xl_14",U="_button_1f9xl_35",A="_popupInner_1f9xl_45",p={popup:F,close:O,button:U,popupInner:A,"slide-in":"_slide-in_1f9xl_1","fade-in":"_fade-in_1f9xl_1"};function m(n){this.message=n}m.prototype=new Error,m.prototype.name="InvalidCharacterError";var v=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(n){var s=String(n).replace(/=+$/,"");if(s.length%4==1)throw new m("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,o,i=0,r=0,a="";o=s.charAt(r++);~o&&(t=i%4?64*t+o:o,i++%4)?a+=String.fromCharCode(255&t>>(-2*i&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return a};function D(n){var s=n.replace(/-/g,"+").replace(/_/g,"/");switch(s.length%4){case 0:break;case 2:s+="==";break;case 3:s+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(v(t).replace(/(.)/g,function(o,i){var r=i.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}(s)}catch{return v(s)}}function u(n){this.message=n}function L(n,s){if(typeof n!="string")throw new u("Invalid token specified");var t=(s=s||{}).header===!0?0:1;try{return JSON.parse(D(n.split(".")[t]))}catch(o){throw new u("Invalid token specified: "+o.message)}}u.prototype=new Error,u.prototype.name="InvalidTokenError";const P="_popup_td4t6_1",q="_open_td4t6_16",G="_popupInner_td4t6_21",J="_close_td4t6_32",_={popup:P,open:q,popupInner:G,close:J},R=({onClose:n,selectedLanguage:s})=>e.jsx("div",{className:_.popup,children:e.jsxs("div",{className:_.popupInner,children:[e.jsx("h2",{children:s==="chinese"?"登陆成功！":"Login successful!"}),e.jsx("p",{children:s==="chinese"?"成功的登陆了。":"Logged in successfully."}),e.jsx("button",{onClick:n,className:_.close,children:s==="chinese"?"返回":"Go back"})]})}),z="_popup_td4t6_1",B="_open_td4t6_16",H="_popupInner_td4t6_21",K="_close_td4t6_32",j={popup:z,open:B,popupInner:H,close:K},M=({onClose:n,selectedLanguage:s})=>e.jsx("div",{className:j.popup,children:e.jsxs("div",{className:j.popupInner,children:[e.jsx("h2",{children:s==="chinese"?"账号不存在！":"Accounts does not exist!"}),e.jsx("p",{children:s==="chinese"?"尝试检查您的用户名和密码。":"Try checking your username and password."}),e.jsx("button",{onClick:n,className:j.close,children:s==="chinese"?"返回":"Go back"})]})}),X=({className:n,onLoginSuccess:s,onClose:t,selectedLanguage:o})=>{const[i,r]=d.useState(!1),[a,y]=d.useState(""),[g,I]=d.useState(""),[h,b]=d.useState({login:!1,success:!1,failed:!1}),k=c=>{t(c)},C=async()=>{const c={username:a,password:g};r(!0);try{const l=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});l.ok?(r(!1),S()):l.status===404?(r(!1),f()):(f(),r(!1),console.error(`Error: ${l.statusText}`));const x=(await l.json()).token;localStorage.setItem("token",x);const w=L(x).username;localStorage.setItem("username",w),s(w,x)}catch{r(!1),f()}},S=()=>{b(()=>({login:!0,success:!0,failed:!1}))},f=()=>{b(()=>({login:!0,failed:!0,success:!1}))},N=c=>{t(c)},$=c=>{t(c)};return e.jsxs("div",{className:T(p.root,n),children:[i&&e.jsx(E,{}),e.jsxs("div",{className:p.popup,children:[h.login&&e.jsxs(e.Fragment,{children:[h.success&&e.jsx("div",{children:e.jsx(R,{onClose:N,selectedLanguage:o})}),h.failed&&e.jsx("div",{children:e.jsx(M,{onClose:$,selectedLanguage:o})})]}),e.jsxs("div",{className:p.popupInner,children:[e.jsx("button",{onClick:k,className:p.close,children:o==="chinese"?"关闭":"Close"}),e.jsx("label",{children:o==="chinese"?"用户名:":"Username:"}),e.jsx("br",{}),e.jsx("input",{type:"text",value:a,onChange:c=>y(c.target.value),required:!0}),e.jsx("br",{}),e.jsx("label",{children:o==="chinese"?"密码:":"Password:"}),e.jsx("br",{}),e.jsx("input",{type:"password",value:g,onChange:c=>I(c.target.value),required:!0}),e.jsx("br",{}),e.jsx("button",{className:p.button,type:"button",onClick:C,children:o==="chinese"?"登陆":"Login"})]})]})]})};export{X as Login};
