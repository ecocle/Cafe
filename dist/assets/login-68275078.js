import{j as e,r as d,c as T,L as E}from"./index-fa3c997d.js";const F="_popup_17rpm_1",O="_close_17rpm_14",U="_button_17rpm_34",A="_popupInner_17rpm_56",l={popup:F,close:O,button:U,popupInner:A,"slide-in":"_slide-in_17rpm_1","fade-in":"_fade-in_17rpm_1"};function g(n){this.message=n}g.prototype=new Error,g.prototype.name="InvalidCharacterError";var v=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(n){var s=String(n).replace(/=+$/,"");if(s.length%4==1)throw new g("'atob' failed: The string to be decoded is not correctly encoded.");for(var t,o,i=0,r=0,a="";o=s.charAt(r++);~o&&(t=i%4?64*t+o:o,i++%4)?a+=String.fromCharCode(255&t>>(-2*i&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return a};function D(n){var s=n.replace(/-/g,"+").replace(/_/g,"/");switch(s.length%4){case 0:break;case 2:s+="==";break;case 3:s+="=";break;default:throw"Illegal base64url string!"}try{return function(t){return decodeURIComponent(v(t).replace(/(.)/g,function(o,i){var r=i.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}(s)}catch{return v(s)}}function u(n){this.message=n}function L(n,s){if(typeof n!="string")throw new u("Invalid token specified");var t=(s=s||{}).header===!0?0:1;try{return JSON.parse(D(n.split(".")[t]))}catch(o){throw new u("Invalid token specified: "+o.message)}}u.prototype=new Error,u.prototype.name="InvalidTokenError";const P="_popup_td4t6_1",q="_open_td4t6_16",G="_popupInner_td4t6_21",J="_close_td4t6_32",x={popup:P,open:q,popupInner:G,close:J},R=({onClose:n,selectedLanguage:s})=>e.jsx("div",{className:x.popup,children:e.jsxs("div",{className:x.popupInner,children:[e.jsx("h2",{children:s==="chinese"?"登陆成功！":"Login successful!"}),e.jsx("p",{children:s==="chinese"?"成功的登陆了。":"Logged in successfully."}),e.jsx("button",{onClick:n,className:x.close,children:s==="chinese"?"返回":"Go back"})]})}),z="_popup_td4t6_1",B="_open_td4t6_16",H="_popupInner_td4t6_21",K="_close_td4t6_32",j={popup:z,open:B,popupInner:H,close:K},M=({onClose:n,selectedLanguage:s})=>e.jsx("div",{className:j.popup,children:e.jsxs("div",{className:j.popupInner,children:[e.jsx("h2",{children:s==="chinese"?"账号不存在！":"Accounts does not exist!"}),e.jsx("p",{children:s==="chinese"?"尝试检查您的用户名和密码。":"Try checking your username and password."}),e.jsx("button",{onClick:n,className:j.close,children:s==="chinese"?"返回":"Go back"})]})}),X=({className:n,onLoginSuccess:s,onClose:t,selectedLanguage:o})=>{const[i,r]=d.useState(!1),[a,y]=d.useState(""),[h,I]=d.useState(""),[f,b]=d.useState({login:!1,success:!1,failed:!1}),k=c=>{t(c)},C=async()=>{const c={username:a,password:h};r(!0);try{const p=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});p.ok?(r(!1),S()):p.status===404?(r(!1),_()):(_(),r(!1),console.error(`Error: ${p.statusText}`));const m=(await p.json()).token;localStorage.setItem("token",m);const w=L(m).username;localStorage.setItem("username",w),s(w,m)}catch{r(!1),_()}},S=()=>{b(()=>({login:!0,success:!0,failed:!1}))},_=()=>{b(()=>({login:!0,failed:!0,success:!1}))},N=c=>{t(c)},$=c=>{t(c)};return e.jsxs("div",{className:T(l.root,n),children:[i&&e.jsx(E,{}),e.jsxs("div",{className:l.popup,children:[f.login&&e.jsxs(e.Fragment,{children:[f.success&&e.jsx("div",{children:e.jsx(R,{onClose:N,selectedLanguage:o})}),f.failed&&e.jsx("div",{children:e.jsx(M,{onClose:$,selectedLanguage:o})})]}),e.jsxs("div",{className:l.popupInner,children:[e.jsx("button",{onClick:k,className:l.close,children:o==="chinese"?"关闭":"Close"}),e.jsx("label",{children:o==="chinese"?"用户名:":"Username:"}),e.jsx("br",{}),e.jsx("input",{type:"text",value:a,onChange:c=>y(c.target.value),required:!0}),e.jsx("br",{}),e.jsx("label",{children:o==="chinese"?"密码:":"Password:"}),e.jsx("br",{}),e.jsx("input",{type:"password",value:h,onChange:c=>I(c.target.value),required:!0}),e.jsx("br",{}),e.jsx("button",{className:l.button,type:"button",onClick:C,disabled:a===""||h==="",children:o==="chinese"?"登陆":"Login"})]})]})]})};export{X as Login};
